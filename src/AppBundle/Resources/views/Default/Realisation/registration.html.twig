{% extends 'AppBundle::layoutFO.html.twig' %}

{% block main %}
    <div class="page-wrap">
        <div class="wc-title-banner">
            <h2>Envoi d'une réalisation</h2>
        </div>
        <div class="wc-container row">
            <div class="col-sm-12">
                <div class="formLogin">
                    {{ form_start(realisationRegistrationForm) }}
                        {{ form_errors(realisationRegistrationForm) }}

                        {{ form_label(realisationRegistrationForm.name) }}
                        {{ form_errors(realisationRegistrationForm.name) }}
                        {{ form_widget(realisationRegistrationForm.name, {'attr': {'placeholder': 'Nom de la réalisation', 'class': 'wc-admin-inputForm'}}) }}

                        {{ form_label(realisationRegistrationForm.file) }}
                        {{ form_errors(realisationRegistrationForm.file) }}
                        {{ form_widget(realisationRegistrationForm.file, {'attr': {'placeholder': 'file', 'class': 'wc-admin-inputForm'}}) }}

                        {{ form_label(realisationRegistrationForm.candidates) }}
                        {{ form_errors(realisationRegistrationForm.candidates) }}
                        <ul id="candidate-fields-list"
                            data-prototype="{{ form_widget(realisationRegistrationForm.candidates.vars.prototype)|e }}">
                        </ul>
                        <a href="#" id="add-another-candidate" class="wc-btn btn-add" style="display: block;">Ajouter un candidat</a>

                        {{ form_widget(realisationRegistrationForm.submit, {'attr': {'value': 'Valider', 'class': 'btnLogin'}}) }}
                    {{ form_end(realisationRegistrationForm) }}
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        var candidateCount = '{{ realisationRegistrationForm.candidates|length }}';

        jQuery(document).ready(function() {
            $collectionHolder = $('ul.candidates');

            $collectionHolder.find('li').each(function() {
                addTagFormDeleteLink($(this));
            });

            jQuery('#add-another-candidate').click(function(e) {
                e.preventDefault();

                var candidateList = jQuery('#candidate-fields-list');

                var newWidget = candidateList.attr('data-prototype');
                newWidget = newWidget.replace(/__name__/g, candidateCount);
                candidateCount++;

                var newLi = jQuery('<li></li>').html(newWidget);
                newLi.appendTo(candidateList);

                addTagFormDeleteLink(newLi);
            });

            if (0 === $collectionHolder.find('li').length) {
                jQuery('#add-another-candidate').trigger('click');
            }
        });

        function addTagFormDeleteLink($tagFormLi) {
            var $removeFormA = $('<a href="#" class="wc-btn btn-delete" style="display: block;">Retirer ce candidat</a>');
            $tagFormLi.append($removeFormA);

            $removeFormA.on('click', function(e) {
                e.preventDefault();

                $tagFormLi.remove();
            });
        }
    </script>

{% endblock %}
